<script>

const SUPABASE_URL="https://tizsemvhdyykizevqsbl.supabase.co";
const SUPABASE_KEY="sb_publishable_ZzxxlCc_IGlHAaeo4OU7Jg_EL5Yhdeq";

const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

const anggota=["Mas Kur","Mba Nurul","Eva","Mba Sri","Mba Salma","Nuki","Tatma"];

const BULAN=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];

let transaksi=[];

const passwordInput=document.getElementById("password");
const app=document.getElementById("app");
const admin=document.getElementById("admin");

async function login(){

let role=passwordInput.value==="admin123"?"admin":"anggota";

app.classList.remove("hidden");

if(role==="admin") admin.classList.remove("hidden");

await loadData();

}

async function loadData(){

const {data,error}=await supabaseClient
  .from("transaksi_kas")
  .select("*");

if(error){
 console.log(error);
 return;
}

transaksi=data;

render();

}

function render(){

let html="";

BULAN.forEach(bulan=>{

let list=transaksi.filter(t=>t.bulan===bulan);

if(list.length===0){

html+=`<tr><td>${bulan}</td><td colspan="8">-</td></tr>`;
return;

}

let rowData={};

list.forEach(t=>{
 rowData[t.anggota]=t.jumlah;
});

let total=0;

html+="<tr>";
html+=`<td>${bulan}</td>`;

anggota.forEach(a=>{

let val=rowData[a]||"";
total+=val||0;

html+=`<td>${val?("Rp "+val.toLocaleString()):""}</td>`;

});

html+=`<td>Rp ${total.toLocaleString()}</td>`;
html+="</tr>";

});

document.getElementById("table-body").innerHTML=html;

}

async function inputPembayaran(){

let nama=document.getElementById("selectAnggota").value;
let bulan=document.getElementById("selectBulan").value;
let jumlah=Number(document.getElementById("inputBayar").value);

await supabaseClient
  .from("transaksi_kas")
  .insert([
    {
      anggota:nama,
      bulan:bulan,
      jumlah:jumlah
    }
  ]);

await loadData();

}

</script>
